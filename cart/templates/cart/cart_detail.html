{% extends "main/base.html" %}
{% load static %}

{% block title %}–ö–æ—Ä–∑–∏–Ω–∞{% endblock %}

{% block content %}
<div class="cart-container">
    <h1 class="section-title">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>
    
    {% if cart %}
        {% for item in cart %}
            <div class="cart-item">
                <div class="cart-item-image">
                    {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                    {% else %}
                        üì¶
                    {% endif %}
                </div>
                
                <div class="cart-item-info">
                    <div class="cart-item-name">{{ item.product.name }}</div>
                        <div class="cart-item-price">{{ item.price }} BYN</div>
                </div>
                
                <div class="cart-item-quantity">
                    <form action="{% url 'cart:cart_add' item.product.id %}" method="post" style="display: flex; align-items: center; gap: 10px;">
                        <button type="button" class="quantity-btn" onclick="changeQuantity(this, -1)">-</button>
                        {{ item.update_quantity_form.quantity }}
                        {{ item.update_quantity_form.override }}
                        <button type="button" class="quantity-btn" onclick="changeQuantity(this, 1)">+</button>
                        <button type="submit" class="btn-primary" style="padding: 8px 16px; font-size: 0.9rem;">–û–±–Ω–æ–≤–∏—Ç—å</button>
                        {% csrf_token %}
                    </form>
                </div>
                
                    <div class="cart-item-total">{{ item.total_price }} BYN</div>
                
                <form action="{% url 'cart:cart_remove' item.product.id %}" method="post" style="margin-left: 10px;">
                    <button type="submit" class="quantity-btn" style="background: var(--danger-color); color: white;" title="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä">
                        üóëÔ∏è
                    </button>
                    {% csrf_token %}
                </form>
            </div>
        {% endfor %}
        
        <div class="cart-total">
            <h3>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</h3>
            <div class="cart-total-amount">{{ cart.get_total_price }} BYN</div>
        </div>
        
        <div class="cart-actions">
            <a href="{% url 'main:product_list' %}" class="btn-primary">
                ‚Üê –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
            </a>
            <a href="#" class="btn-primary" style="background: var(--success-color);">
                –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí
            </a>
        </div>
    {% else %}
        <div class="empty-cart">
            <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
            <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–¥–µ—Å—å</p>
            <a href="{% url 'main:product_list' %}" class="btn-primary">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–æ–≤–∞—Ä–∞–º
            </a>
        </div>
    {% endif %}
</div>

<script>
function changeQuantity(button, change) {
    const form = button.closest('form');
    const quantityInput = form.querySelector('input[name="quantity"]');
    let currentValue = parseInt(quantityInput.value) || 1;
    let newValue = currentValue + change;
    
    if (newValue < 1) newValue = 1;
    
    quantityInput.value = newValue;
}
</script>
{% endblock %}